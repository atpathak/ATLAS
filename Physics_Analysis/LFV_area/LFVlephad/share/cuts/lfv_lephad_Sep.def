# -*- mode:tqfolder -*-

+CutBase{
  <.cutExpression = "1.", .weightExpression = "{$(isData) ? 1. : [ScaleFactor_$(weightvariation)]}", .title = "Baseline">
  +CutChannel{
    <.cutExpression = "$(fitsChannel)", .title = "Channel">
    +CutHadTau{
      <.cutExpression = "{$(isSignal) ? (abs(tau_0_truth_pdgId)==15) : 1.}", .title = "Had Tau">
      +CutVBFFilter{
        <.cutExpression = "{$(isData) ? 1 : (truth_passedVBFFilter == 0)}", .title = "VBF Filter">
        +CutTrigger{
          <.cutExpression = "[Trigger] == 1", .title = "Trigger" >
          +CutNPVX{
            <.cutExpression = "n_pvx > 0", .title = "NPVX">
	    +CutLepQual{
              <.cutExpression = "{$(isETAU) ? lep_0_id_medium == 1 && lep_0_iso_Gradient == 1 && fabs(lep_0_eta) < 2.47 && !(fabs(lep_0_eta)>1.37 && fabs(lep_0_eta)<1.52) : lep_0_id_medium == 1 && lep_0_iso_Gradient == 1 && fabs(lep_0_eta) < 2.5}", .title = "LepQual">
              +CutTauQual{
                <.cutExpression = "n_taus > 0 && abs(tau_0_q) == 1 && abs(tau_0_eta) < 2.4 && !(fabs(tau_0_eta)>1.37 && fabs(tau_0_eta)<1.52)", .title = "TauQual">
                +CutOS{
                  <.cutExpression = "lephad_qxq == -1", .title = "OS">
                  +CutTauAntiTau{
		    <.cutExpression = "{$(isFailID) ? (tau_0_jet_bdt_tight == 0  && tau_0_jet_bdt_score > 0.5) : (tau_0_jet_bdt_tight == 1)}", .title = "TauAntiTau">
	            +CutNoJetFake{
	              <.cutExpression = "{$(isData) ? 1. : !(abs(tau_0_truth_pdgId) < 6 || tau_0_truth_pdgId == 21)}", .title = "NoJetFake" >
                      +CutLepPt{
                        <.cutExpression = "lep_0_pt > 27.3", .title = "MuonPt">
                        +CutTauPt{
                          <.cutExpression = "tau_0_pt > 25.", .title = "TauPt">
                          +CutZVeto{
			    <.cutExpression = "{$(isETAU) ? (tau_0_n_tracks==1) || (tau_0_n_tracks==3 && tau_0_ele_BDTEleScoreTrans_run2 > 0.05) : 1.}", .title = "ZVeto">
			    +CutFake{
                              <.cutExpression = "1.", .title = "Preselection", .weightExpression = "{$(isFailID) ? [fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
			      +CutCosDPhi{
                                <.cutExpression = "( cos($(dPhiTauMET)) + cos($(dPhiLepMET)) ) > -0.35", .title = "CosDPhi">
			        +CutDEta{
			          <.cutExpression = "abs(lep_0_eta - tau_0_eta) < 2.", .title = "MuonPt">
			          +CutNbjets{
                                    <.cutExpression = "n_bjets == 0", .title = "MuonPt">
                                    +CutEFake{
                                      <.cutExpression = "{$(isEFake) ? ((tau_0_n_tracks==1 && tau_0_ele_BDTEleScoreTrans_run2 < 0.15) || tau_0_n_tracks==3) : 1.}", .title = "Preselection", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR0_$(fakevariation)]/[fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
				      +CutPreselection{
                                        <.cutExpression = "{($(isETAU) && !$(isEFake)) ? (tau_0_n_tracks==1 && tau_0_ele_BDTEleScoreTrans_run2 > 0.15) || (tau_0_n_tracks==3) : 1.}", .title = "Preselection", .weightExpression = "{ ( $(isEFake) && [tau_0_n_tracks==1]) ? [eFakeFactorPreselection_$(efakevariation)] : 1.}">
				    }
			    	  }
				}
			      }
			    }
			  }
			}
		      }
		    }
		  }
		}
	      }
            }
	  }
	}
      }
    }
  }
}

# Signal regions for 1 prong
@*/CutPreselection {
+CutSR_1P{
    <.cutExpression = "tau_0_n_tracks == 1", .title = "SR 1prong"> 
  +CutTauPtSR_1P{
    <.cutExpression = "tau_0_pt > 45.", .title = "SR1 DEta">  
    +CutLepMTSR1_1P{
      <.cutExpression = "lephad_mt_lep0_met > 40.", .title = "SR1 LepMET MT">
      +CutTauMTSR1_1P{
        <.cutExpression = "taumet_transverse_mass < 30.", .title = "SR1 TauMET MT", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR1_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
	+CutTauMTSR1_VBF_1P{
          <.cutExpression = "!(n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.)", .title = "SR1 TauMET MT">
	}
      }
    }
    +CutLepMTSR2_1P{
      <.cutExpression = "lephad_mt_lep0_met < 40.", .title = "SR1 LepMET MT">
      +CutTauMTSR2_1P{
        <.cutExpression = "taumet_transverse_mass < 60.", .title = "SR1 TauMET MT", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR2_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
	  +CutTauMTSR2_Mvis_1P{
            <.cutExpression = "lephad_vis_mass > 100.", .title = "SR1 TauMET MT", >
	    +CutTauMTSR2_VBF_1P{
              <.cutExpression = "!(n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.)", .title = "SR1 TauMET MT">
            }
	  }
	}
      }
    }
  }
 }
# Signal regions for 3 prong
@*/CutPreselection {
+CutSR_3P{
    <.cutExpression = "tau_0_n_tracks == 3", .title = "SR 3prong"> 
    +CutTauPtSR_3P{
	<.cutExpression = "tau_0_pt > 45.", .title = "SR1 DEta">  
    	+CutLepMTSR1_3P{
	    <.cutExpression = "lephad_mt_lep0_met > 40.", .title = "SR1 LepMET MT">
      	    +CutTauMTSR1_3P{
		<.cutExpression = "taumet_transverse_mass < 30.", .title = "SR1 TauMET MT", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR1_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
		+CutTauMTSR1_VBF_3P{
          	<.cutExpression = "!(n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.)", .title = "SR1 TauMET MT">
	   }
	}		
    }
    +CutLepMTSR2_3P{
      <.cutExpression = "lephad_mt_lep0_met < 40.", .title = "SR1 LepMET MT">
      +CutTauMTSR2_3P{
        <.cutExpression = "taumet_transverse_mass < 60.", .title = "SR1 TauMET MT", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR2_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
	  +CutTauMTSR2_Mvis_3P{
            <.cutExpression = "lephad_vis_mass > 100.", .title = "SR1 TauMET MT", >
	    +CutTauMTSR2_VBF_3P{
              <.cutExpression = "!(n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.)", .title = "SR1 TauMET MT">
              }
	    }
          }
        }
      }
    }
  }
}


@*/CutPreselection {
  +CutSR3_1P{
     <.cutExpression = "tau_0_n_tracks == 1", .title = "SR3 1prong"> 
     +CutLepPtSR3_1P{
        <.cutExpression = "lep_0_pt > 45.", .title = "SR1 DEta",.weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR3_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
        +CutTauPtSR3_1P{
           <.cutExpression = "tau_0_pt < 45. && lephad_mt_lep0_met > 40. && taumet_transverse_mass < 30.", .title = "SR1 TauMET MT">
           +CutTauPtSR3_VBF_1P{
             <.cutExpression = "!(n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.)", .title = "SR1 TauMET MT">
        }
      }
    }
  }
}
@*/CutPreselection {
  +CutSR3_3P{
    <.cutExpression = "tau_0_n_tracks == 3", .title = "SR3 3prong"> 
    +CutLepPtSR3_3P{
      <.cutExpression = "lep_0_pt > 45.", .title = "SR1 DEta",.weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSR3_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
      +CutTauPtSR3_3P{
        <.cutExpression = "tau_0_pt < 45. && lephad_mt_lep0_met > 40. && taumet_transverse_mass < 30.", .title = "SR1 TauMET MT">
        +CutTauPtSR3_VBF_3P{
           <.cutExpression = "!(n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.)", .title = "SR1 TauMET MT">
        }
      }
    }
  }
}

@*/CutFake {
  +CutEleFF{
    <.cutExpression = "{$(isEFake) ? ((tau_0_n_tracks==1 && tau_0_ele_BDTEleScoreTrans_run2 < 0.15) || tau_0_n_tracks==3) : 1}", .title = "Preselection", .weightExpression = "{ ( $(isEFake) && [tau_0_n_tracks==1]) ? [eFakeFactorPreselection_$(efakevariation)] : 1.}">
    +CutEleFF1{
      <.cutExpression = "{($(isETAU) && !$(isEFake)) ? (tau_0_n_tracks==1 && tau_0_ele_BDTEleScoreTrans_run2 > 0.15) || (tau_0_n_tracks==3) : 1.}", .title = "Preselection">
      +CutWCR{
        <.cutExpression = "abs(lep_0_eta - tau_0_eta) < 2. && lephad_mt_lep0_met > 60. && taumet_transverse_mass > 40. && n_bjets == 0", .title = "WCR", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSRW_$(fakevariation)]/[fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
      }
      +CutTopCR{
        <.cutExpression = "abs(lep_0_eta - tau_0_eta) < 2. && n_jets > 1 && n_bjets > 0 && lephad_mt_lep0_met > 100.", .title = "TopCR", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSRTop_$(fakevariation)]/[fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
      }
      +CutQCDCR{
        <.cutExpression = "lephad_mt_lep0_met < 60. && n_bjets == 0 && abs(lep_0_eta - tau_0_eta) > 2.", .title = "QCDCR", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSRQCD_$(fakevariation)]/[fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
      }
      +CutQCDCR2{
        <.cutExpression = "tau_0_pt < 45. && lephad_mt_lep0_met < 40. && taumet_transverse_mass < 60. && n_bjets == 0 && abs(lep_0_eta - tau_0_eta) > 2.", .title = "QCDCR2", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSRQCD2_$(fakevariation)]/[fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
      }
      +CutZttCR{
        <.cutExpression = "tau_0_pt < 45. && lephad_mt_lep0_met < 40. && taumet_transverse_mass < 60. && n_bjets == 0 && abs(lep_0_eta - tau_0_eta) < 2.", .title = "ZttCR", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSRZtt_$(fakevariation)]/[fakeFactorPreselectionSR_$(fakevariation)] : 1.}">
      }
      +CutVBF{
        <.cutExpression = "tau_0_pt > 45. && abs(lep_0_eta - tau_0_eta) < 2. && n_bjets == 0 && n_jets > 1 && jet_0_pt > 40. && jet_1_pt > 30. && fabs(jets_delta_eta) > 3. && jets_visible_mass > 400.", .title = "VBFSR", .weightExpression = "{ ( $(isFailID) ) ? [fakeFactorPreselectionSRVBF_$(fakevariation)]/[fakeFactorPreselectionSR0_$(fakevariation)] : 1.}">
      }
    }
  }
}





